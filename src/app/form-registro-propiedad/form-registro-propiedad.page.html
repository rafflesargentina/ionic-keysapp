<ion-header class="ion-no-border">
  <ion-toolbar>
    <app-header [titulo]="titulo" [icono]="'back'" (volver)="atras()"></app-header>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!--titulos-->
  <div class="div1">
    <h1 >Registrá una Propiedad</h1>
    <h4 >En dos simples pasos</h4>
  </div>
  <ion-segment value="first" (ionChange)="segmentChanged($event)">
    <ion-segment-button value="first">
      <ion-label>Primer Paso</ion-label>
    </ion-segment-button>
    <ion-segment-button value="second">
      <ion-label>Segundo Paso</ion-label>
    </ion-segment-button>
  </ion-segment>
  <!--formulario-->
  <form [formGroup]="datosForm">
    
    <div *ngIf="segment == 'first'">
      <!--propietario-->

      <!--nombre-->
      <ion-item [class.invalid]="submitted && !datosForm.controls.name.valid">
        <ion-label position="floating">Nombre</ion-label>     
        <ion-input name="nombre" type="text" formControlName="name" 
                    required ></ion-input>
        <div *ngIf="submitted && f.name.errors" class="invalid-feedback">
            <div *ngIf="f.name.errors.required"><h5>Ingresa un Nombre</h5></div>
        </div>
      </ion-item>

      <div [class.invalid]="submitted && !datosForm.controls.property_id.valid">

        {{propietarioAsignado.name}}         
 
        <ion-button type="button" expand="block" (click)="seleccionarPropietario()">Asignar Propietario</ion-button>
        <div *ngIf="submitted && f.property_id.errors" class="invalid-feedback">
          <div *ngIf="f.property_id.errors.required"><h5>Selecciona un Propietario</h5></div>
        </div>
      </div>

      <ion-item>
        <ion-label position="floating">Tipo de Inmueble</ion-label> 
        <ion-select ok-text="Ok" cancel-text="Cancelar" expand="full" formControlName="property_type_id" >
          <ion-select-option [value]="tipo.id" *ngFor="let tipo of tipos">
            {{tipo.name}}
          </ion-select-option>
        </ion-select>        
      </ion-item>

      <ion-item [class.invalid]="submitted && !datosForm.controls.address.valid">
        <app-input-ubicacion          
          [country]="inmueble.address.country"
          [street_number]="inmueble.address.street_number"
          [street_name] ="inmueble.address.street_name" 
          [locality]="inmueble.address.locality"
          [state] ="inmueble.address.state"
          [door_number]="inmueble.address.door_number"  
          [floor_number]="inmueble.address.floor_number" 
          [latitud]="inmueble.address.lat" 
          [longitud]="inmueble.address.lng"  
          [location]="inmueble.address.location"      
          (onSelectValue)='setValue($event)' >
        </app-input-ubicacion> 
      </ion-item>
      <div *ngIf="submitted && f.address.errors" class="invalid-feedback">
        <div *ngIf="f.address.errors.required"><h5>Ingresa una Dirección</h5></div>
      </div>
    </div >

    <!-- agregar operacion listado de operaciones: con presio moneda y estado. -->
    
    <div *ngIf="segment == 'second'">
      <ion-button expand="block" (click)="seleccionarOperaciones()">Agregar Operación</ion-button>
      <ion-list *ngIf="operaciones.length > 0" >
        <ion-item *ngFor="let operacion of operaciones; let i = index;" [class.invalid]="submitted && !datosForm.controls.operations.valid">
          <ion-label>
            <h2 size="10">{{operacion.operation_type_name}}</h2>
            <h2 size="10">{{operacion.value}}  {{operacion.currency}}</h2>
          </ion-label>
          <ion-icon name="trash" color="danger" slot="end" (click)="eliminarOperacion(i)" size="2"></ion-icon>
          <div *ngIf="submitted && f.operations.errors" class="invalid-feedback">
            <div *ngIf="f.operations.errors.required"><h5>Selecciona al menos una operación</h5></div>
          </div>
        </ion-item> 
      </ion-list>
      <br>
      <!--descripcion-->
      <ion-item>
        <ion-label position="floating">Descripción</ion-label>
        <ion-textarea placeholder="Ingrese una descripción de la propiedad" name="description" formControlName="description">
        </ion-textarea>
      </ion-item>
      <br>
      <ion-footer position="fixed-bottom">
        <!--boton submit-->
        <ion-button type="submit" expand="block" (click)="registrar()">Guardar</ion-button> 
      </ion-footer>  
    </div > 
  </form>
</ion-content>
